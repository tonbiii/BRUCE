<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in || Sign up Form</title>
    <!-- font awesome icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- css stylesheet -->
    <link rel="stylesheet" href="style.css">
    <style>
        .password-field {
            position: relative;
        }
        .password-field input {
            padding-right: 30px; /* Add space for the icon */
        }
        .password-field i {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <h1>WELCOME TO YOUR EA DASHBOARD</h1>
    </header>

    <div class="container" id="container">
        <div class="form-container sign-up-container">
            <form id="signUpForm" action="javascript:void(0);">
                <h1>Create Account</h1>
                <div class="infield">
                    <input type="text" placeholder="Username" name="username" id="signup-username" required/>
                    <label></label>
                </div>
                <div class="infield">
                    <input type="text" placeholder="MT4 Account ID" name="mt4-account-id" id="signup-account-id" required/>
                    <label></label>
                </div>
                <div class="infield">
                    <input type="text" placeholder="MT4 Broker Server" name="mt4-server" id="signup-server" required/>
                    <label></label>
                </div>
                <div class="infield password-field">
                    <input type="password" placeholder="Password" name="password" id="signup-password" required/>
                    <i class="fa fa-eye" id="toggleSignupPassword"></i>
                    <label></label>
                </div>
                <button type="submit">Sign Up</button>
            </form>
        </div>
        <div class="form-container sign-in-container">
            <form id="signInForm" action="javascript:void(0);">
                <h1>Sign in</h1>
                <div class="infield">
                    <input type="text" placeholder="Username" name="username" id="signin-username" required/>
                    <label></label>
                </div>
                <div class="infield password-field">
                    <input type="password" placeholder="Password" name="password" id="signin-password" required/>
                    <i class="fa fa-eye" id="toggleSigninPassword"></i>
                    <label></label>
                </div>
                <a href="#" class="forgot">Forgot your password?</a>
                <button type="submit">Sign In</button>
            </form>
        </div>
        <div class="overlay-container" id="overlayCon">
            <div class="overlay">
                <div class="overlay-panel overlay-left">
                    <h1>Welcome Back!</h1>
                    <p>To keep connected with us please login with your personal info</p>
                    <button id="signIn">Sign In</button>
                </div>
                <div class="overlay-panel overlay-right">
                    <h1>Hello, Friend!</h1>
                    <p>Enter your personal details and start your journey with us</p>
                    <button id="signUp">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <!-- js code -->
    <script>
        // Panel switching
        const container = document.getElementById('container');
        const signUpButton = document.getElementById('signUp');
        const signInButton = document.getElementById('signIn');

        signUpButton.addEventListener('click', () => {
            container.classList.add('right-panel-active');
        });

        signInButton.addEventListener('click', () => {
            container.classList.remove('right-panel-active');
        });

        // Handle sign-up form submission without page reload
        document.getElementById('signUpForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            
            const username = document.getElementById('signup-username').value;
            const accountId = document.getElementById('signup-account-id').value;
            const server = document.getElementById('signup-server').value;
            const password = document.getElementById('signup-password').value;

            const response = await fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username,
                    mt4AccountId: accountId,
                    mt4Server: server,
                    password
                })
            });

            const result = await response.json();
            if (response.ok) {
                alert('Account created successfully');
            } else {
                alert('Failed to create account: ' + (result.message || 'Unknown error'));
            }
        });

        // Handle sign-in form submission without page reload
        document.getElementById('signInForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            
            const username = document.getElementById('signin-username').value;
            const password = document.getElementById('signin-password').value;

            const response = await fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username,
                    password
                })
            });

            const result = await response.json();
            if (response.ok) {
                alert('Login successful');
                localStorage.setItem('token', result.token); // Save token for authenticated requests
            } else {
                alert('Failed to login: ' + (result.message || 'Unknown error'));
            }
        });

        // Toggle password visibility for sign-up
        const toggleSignupPassword = document.getElementById('toggleSignupPassword');
        const signupPassword = document.getElementById('signup-password');
        if (toggleSignupPassword && signupPassword) {
            toggleSignupPassword.addEventListener('click', function () {
                const type = signupPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                signupPassword.setAttribute('type', type);
                this.classList.toggle('fa-eye-slash');
            });
        }

        // Toggle password visibility for sign-in
        const toggleSigninPassword = document.getElementById('toggleSigninPassword');
        const signinPassword = document.getElementById('signin-password');
        if (toggleSigninPassword && signinPassword) {
            toggleSigninPassword.addEventListener('click', function () {
                const type = signinPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                signinPassword.setAttribute('type', type);
                this.classList.toggle('fa-eye-slash');
            });
        }
    </script>
</body>
</html>
